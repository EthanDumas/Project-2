#include "Board.h"

Board::Board()
{
    resetBoard();
}

void Board::resetBoard()
{
    const int COLOR_COUNT = 3;
    const string COLORS[COLOR_COUNT] = {MAGENTA, GREEN, BLUE};
    Tile new_tile;
    string current_color;
    for (int i = 0; i < _BOARD_SIZE - 1; i++)
    {
        current_color = COLORS[i % COLOR_COUNT];
        new_tile = {current_color, "regular tile"};
        _tiles[i] = new_tile;
    }
    new_tile = {ORANGE, "regular tile"};
    _tiles[_BOARD_SIZE - 1] = new_tile;

    _candy_store_count = 0;
    for (int i = 0; i < _MAX_CANDY_STORE; i++)
    {
        _candy_store_position[i] = -1;
    }

    _player_position = 0;
}

void Board::displayTile(int position)
{
    if (position < 0 || position >= _BOARD_SIZE)
    {
        return;
    }
    Tile target = _tiles[position];
    cout << target.color << " ";
    if (position == _player_position)
    {
        cout << "X";
    }
    else
    {
        cout << " ";
    }
    cout << " " << RESET;
}

void Board::displayBoard()
{
    // First horizontal segment
    for (int i = 0; i <= 23; i++)
    {
        displayTile(i);
    }
    cout << endl;
    // First vertical segment
    for (int i = 24; i <= 28; i++)
    {
        for (int j = 0; j < 23; j++)
        {
            cout << "   ";
        }
        displayTile(i);
        cout << endl;
    }
    // Second horizontal segment
    for (int i = 52; i > 28; i--)
    {
        displayTile(i);
    }
    cout << endl;
    // Second vertical segment
    for (int i = 53; i <= 57; i++)
    {
        displayTile(i);
        for (int j = 0; j < 23; j++)
        {
            cout << "   ";
        }
        cout << endl;
    }
    // Third horizontal segment
    for (int i = 58; i < _BOARD_SIZE; i++)
    {
        displayTile(i);
    }
    cout << ORANGE << "Castle" << RESET << endl;
}

bool Board::setPlayerPosition(int new_position)
{
    if (new_position >= 0 && new_position < _BOARD_SIZE)
    {
        _player_position = new_position;
        return true;
    }
    return false;
}

int Board::getBoardSize() const
{
    return _BOARD_SIZE;
}

int Board::getCandyStoreCount() const
{
    return _candy_store_count;
}

int Board::getPlayerPosition() const
{
    return _player_position;
}

bool Board::addCandyStore(int position)
{
    if (_candy_store_count >= _MAX_CANDY_STORE)
    {
        return false;
    }
    _candy_store_position[_candy_store_count] = position;
    _candy_store_count++;
    return true;
}

bool Board::isPositionCandyStore(int board_position)
{
    for (int i = 0; i < _candy_store_count; i++)
    {
        if(_candy_store_position[i] == board_position)
        {
            return true;
        }
    }
    return false;
}

bool Board::movePlayer(int tile_to_move_forward)
{
    tile_to_move_forward = getCardMovement();

    int new_player_position = tile_to_move_forward + _player_position;
    if(new_player_position < 0 || new_player_position >= _BOARD_SIZE)
    {
        return false;
    }
    _player_position = new_player_position;
    return true;
}

int Board::getCandyStoreIndex(int board_position) {
    for(int i = 0; i < _candy_store_count; i++) {
        if(_candy_store_position[i] == board_position) {
            return i;
        }
    }
    return -1;
}

Card getCard() {
    string card_name;
    Card card; 
    
    switch(rand() % 3){
        case 0:
        card_name = "Magnificant Magenta Mango \033[;45m";
        card.color = "Magenta";
        cout << "You pulled a " << card_name << "!" << endl;
        return card;

        case 1:
        card_name = "Groovy Green Greengage \033[;42m";
        card.color = "Green";
        cout << "You pulled a " << card_name << "!" << endl;
        return card;
        
        case 2:
        card_name = "Brilliant Blue Blueberry \033[;44m";
        card.color = "Blue";
        cout << "You pulled a " << card_name << "!" << endl;
        return card;
        
        default:
        card_name = "";
        card.color = "";
        return card;
    }
}

bool checkCardValue() {
    int value = rand() % 10;
    if(value == 0){
        return true;
    }
    else{
        return false;
    }
}

int getCardMovement() {
    Card _card;
    Board player;

    _card = getCard();
    if(checkCardValue() == false){
        for(int i = 1; i < 4; i++){
            int possible_move = player.getPlayerPosition() + i;
            int true_move;
                if(_card.color == "Magenta"){
                    if(possible_move % 3 == 0){
                        true_move = possible_move;
                        return true_move;
                    }
                    else if(possible_move % 3 != 0){
                        return 0;
                    }
                    return true_move;
                }
                else if(_card.color == "Green"){
                    if(possible_move % 3 == 1){
                        true_move = possible_move;
                        return true_move;
                    }
                    else if(possible_move % 3 != 1){
                        return 0;
                    }
                    return true_move;
                }
                else if(_card.color == "Blue"){
                    if(possible_move % 3 == 2){
                        true_move = possible_move;
                        return true_move;
                    }
                    else if(possible_move % 3 != 2){
                        return 0;
                    }
                    return true_move;
                }
        }
    }
    else if(checkCardValue() == true){
        for(int i = 1; i < 4; i ++){
            int two_possible_move = player.getPlayerPosition() + (3 + i);
            int two_true_move;
                if(_card.color == "Magenta"){
                    if(two_possible_move % 3 == 0){
                        two_true_move = two_possible_move;
                        return two_true_move;
                    }
                    else if(two_possible_move % 3 != 0){
                        return 0;
                    }
                }
                else if(_card.color == "Green"){
                    if(two_possible_move % 3 == 1){
                        two_true_move = two_possible_move;
                        return two_true_move;
                    }
                    else if(two_possible_move % 3 != 1){
                        return 0;
                    }
                    return two_true_move;
                }
                else if(_card.color == "Blue"){
                    if(two_possible_move % 3 == 2){
                        two_true_move = two_possible_move;
                        return two_true_move;
                    }
                    else if(two_possible_move % 3 != 2){
                        return 0;
                    }
                    return two_true_move;
                }
        }
    }      
}







